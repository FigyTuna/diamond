<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Diamond Game</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #303030;
		}
	</style>
	<script src="pixi.js"></script>
</head>
<body>
	<script>
		var stage = new PIXI.Stage(0x505050);
		var renderer = PIXI.autoDetectRenderer(1000, 600);
		document.body.appendChild(renderer.view);
		requestAnimFrame(animate);

		//------------------------------------

		var personTexture = PIXI.Texture.fromImage("guy.png");

		var tileTexture = PIXI.Texture.fromImage("tile.png");

		var underTexture = PIXI.Texture.fromImage("under.png");

		//----------------------------------- MOVEMENT VARIABLES

		var left = false;
		var up = false;
		var right = false;
		var down = false;

		var lr = 0;
		var ud = 0;

		var speed = 3;

		//------------------------------------- TEMP VARIABLES

		var map = new Array(10);
		for(var i = 0; i < map.length; i++){
			map[i] = new Array(10);
		}
		for(var i = 0; i < map.length; i++){
			for(var j = 0; j < map[0].length; j++){
				map[i][j] = 0;
			}
		}
		map[3][7] = 1;
		map[5][6] = 2;
		map[6][6] = 3;
		map[5][5] = 6;
		map[6][5] = 1;

		//------------------------------------- TILES

		var size = 10;//FINAL
		var start = 100;//Depends on other things. Should be centered.

		for(var i = 0; i < size; i++){
			for(var j = 0; j < size; j++){
				var tile = new PIXI.Sprite(tileTexture);

				tile.anchor.x = tile.anchor.y = 0.5;

				tile.position.x = (size - 1 + i - j) * 30 + start;
				tile.position.y = (i + j) * 20 + start - (12 * map[i][j]); //-12 under hiehgt.

				stage.addChild(tile);

				for(var k = map[i][j]; k > 0; k--){
					var under = new PIXI.Sprite(underTexture);

					under.anchor.x = tile.anchor.y = 0.5;

					under.position.x = (size - 1 + i - j) * 30 + start + 15; // +15 offset to right.
					under.position.y = (i + j) * 20 + start - (12 * k); //-12 to be changed.

					stage.addChild(under);

					var under2 = new PIXI.Sprite(underTexture);

					under2.anchor.x = tile.anchor.y = 0.5;

					under2.scale.x = -1;

					under2.position.x = (size - 1 + i - j) * 30 + start - 15; // -15 offset to left.
					under2.position.y = (i + j) * 20 + start - (12 * k); //-12 to be changed.

					stage.addChild(under2);
				}
			}
		}

		//--------------------------------------- PERSON

		var person = new PIXI.Sprite(personTexture);

		var guyx = 250;
		var guyy = 150;

		person.anchor.x = person.anchor.y = 0.5;
		person.position.x = guyx;
		person.position.y = guyy;

		stage.addChild(person);

		//-------------------------------------------- INPUT

		document.addEventListener('keydown', function(event){
			var code = event.keyCode;

			if(code == 65){ //A
				left = true;
			}
			if(code == 87){ //W
				up = true;
			}
			if(code == 68){ //D
				right = true;
			}
			if(code == 83){ //S
				down = true;
			}

		})

		document.addEventListener('keyup', function(event){
			var code = event.keyCode;

			if(code == 65){ //A
				left = false;
			}
			if(code == 87){ //W
				up = false;
			}
			if(code == 68){ //D
				right = false;
			}
			if(code == 83){ //S
				down = false;
			}
		})

		//--------------------------------------------------------------------- GAME LOOP

		function animate(){
			requestAnimFrame(animate);

			movement();
			update();

			renderer.render(stage);
		}

		function update(){
			person.position.x = guyx; //Useless for now.
			person.position.y = guyy;
		}

		//----------------------------------------------- MOVEMENT

		function movement(){
			guyx += lr;
			guyy += ud;

			if(left){
				lr = -speed;
			}
			if(up){
				ud = -speed;
			}
			if(right){
				lr = speed;
			}
			if(down){
				ud = speed;
			}

			lr /= 1.15;
			ud /= 1.15;
		}
	</script>
</body>
